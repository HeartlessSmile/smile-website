import{_ as s,c as a,a as p,o as t}from"./app-DzEwyuga.js";const e="/smile-website/images/rollup/image-20230919180002325.png",o="/smile-website/images/rollup/image-20230920110457237.png",l={};function c(i,n){return t(),a("div",null,n[0]||(n[0]=[p(`<h1 id="æ’ä»¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶æœºåˆ¶"><span>æ’ä»¶æœºåˆ¶</span></a></h1><h2 id="rollupæ’ä»¶æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#rollupæ’ä»¶æ¦‚è¿°"><span>Rollupæ’ä»¶æ¦‚è¿°</span></a></h2><blockquote><p>Rollup æ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰ <a href="https://cn.rollupjs.org/plugin-development/#properties" target="_blank" rel="noopener noreferrer">å±æ€§</a>ã€<a href="https://cn.rollupjs.org/plugin-development/#build-hooks" target="_blank" rel="noopener noreferrer">æ„å»ºé’©å­</a> å’Œ <a href="https://cn.rollupjs.org/plugin-development/#output-generation-hooks" target="_blank" rel="noopener noreferrer">è¾“å‡ºç”Ÿæˆé’©å­</a> ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¹¶éµå¾ªæˆ‘ä»¬çš„ <a href="https://cn.rollupjs.org/plugin-development/#conventions" target="_blank" rel="noopener noreferrer">çº¦å®š</a>ã€‚æ’ä»¶åº”ä½œä¸ºä¸€ä¸ªå¯¼å‡ºä¸€ä¸ªå‡½æ•°çš„åŒ…è¿›è¡Œå‘å¸ƒï¼Œè¯¥å‡½æ•°å¯ä»¥ä½¿ç”¨æ’ä»¶ç‰¹å®šçš„é€‰é¡¹è¿›è¡Œè°ƒç”¨å¹¶è¿”å›æ­¤ç±»å¯¹è±¡ã€‚</p></blockquote><p>ç®€å•æ¥è¯´ï¼Œrollupæ’ä»¶ä¸€èˆ¬ä¼šåšæˆä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡ä¸­åŒ…å«ä¸€äº›å±æ€§å’Œä¸åŒé˜¶æ®µçš„é’©å­å‡½æ•°ã€‚</p><h3 id="çº¦å®š" tabindex="-1"><a class="header-anchor" href="#çº¦å®š"><span>çº¦å®š</span></a></h3><p>æ’ä»¶åº”è¯¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„åç§°ï¼Œå¹¶ä»¥<code>rollup-plugin-</code>ä½œä¸ºå‰ç¼€ã€‚</p><h3 id="å±æ€§" tabindex="-1"><a class="header-anchor" href="#å±æ€§"><span>å±æ€§</span></a></h3><p>nameï¼šæ’ä»¶çš„åç§°ï¼Œç”¨äºåœ¨è­¦å‘Šå’Œé”™è¯¯æ¶ˆæ¯ä¸­æ ‡è¯†æ’ä»¶ã€‚</p><p>versionï¼šæ’ä»¶çš„ç‰ˆæœ¬</p><h2 id="é’©å­å‡½æ•°çš„ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#é’©å­å‡½æ•°çš„ç‰¹ç‚¹"><span>é’©å­å‡½æ•°çš„ç‰¹ç‚¹</span></a></h2><ul><li>é’©å­å‡½æ•°åŒºåˆ†ä¸åŒçš„è°ƒç”¨æ—¶æœº</li><li>é’©å­å‡½æ•°æ˜¯æœ‰æ‰§è¡Œé¡ºåºçš„</li><li>é’©å­å‡½æ•°æœ‰ä¸åŒçš„æ‰§è¡Œæ–¹å¼</li><li>é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡çš„å½¢å¼</li><li>å¯¹è±¡å½¢å¼çš„é’©å­å‡½æ•°å¯ä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼Œè®©ä¸åŒæ’ä»¶çš„åŒåé’©å­å‡½æ•°è·å–ä¸é€šçš„æ‰§è¡Œå…ˆå</li></ul><h3 id="é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº" tabindex="-1"><a class="header-anchor" href="#é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº"><span>é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº</span></a></h3><p>è¿™é‡Œçš„è°ƒç”¨æ—¶æœºï¼Œå…¶å®å°±æ˜¯ä»¥æˆ‘ä»¬ä¸Šé¢çš„APIï¼Œbuildå’Œoutputä¸¤å¤§å·¥ä½œæµçš„ä¸åŒé˜¶æ®µè¿›è¡Œåˆ†ç±»ã€‚æ ¹æ®è¿™ä¸¤ä¸ªä¸åŒé˜¶æ®µï¼Œrollupæä¾›çš„ä¸åŒçš„å‡½æ•°è®©æˆ‘ä»¬è°ƒç”¨</p><ul><li>const bundle = await rollup.rollup(inputOptions) æ‰§è¡ŒæœŸé—´çš„æ„å»ºé’©å­å‡½æ•° - <a href="https://cn.rollupjs.org/plugin-development/#build-hooks" target="_blank" rel="noopener noreferrer">build-hooks</a></li><li>await bundle.generate(outputOptions)/write(outputOptions) æ‰§è¡ŒæœŸé—´çš„è¾“å‡ºé’©å­å‡½æ•°-<a href="https://cn.rollupjs.org/plugin-development/#output-generation-hooks" target="_blank" rel="noopener noreferrer">output-generation-hooks</a></li></ul><h3 id="é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼"><span>é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼</span></a></h3><p>é™¤äº†ä¸Šé¢ç®€å•çš„åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µçš„è°ƒç”¨æ—¶æœºä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»¥é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼æ¥åˆ†ç±»ã€‚</p><ul><li><code>async/sync</code>ï¼šå¼‚æ­¥/åŒæ­¥é’©å­ï¼Œasyncæ ‡è®°çš„é’©å­å¯ä»¥è¿”å›ä¸€ä¸ªè§£æä¸ºç›¸åŒç±»å‹çš„å€¼çš„ Promiseï¼›å¦åˆ™ï¼Œè¯¥é’©å­è¢«æ ‡è®°ä¸º <code>sync</code>ã€‚</li><li><code>first</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™é’©å­æŒ‰é¡ºåºè¿è¡Œï¼Œç›´åˆ°é’©å­è¿”å›ä¸€ä¸ªä¸æ˜¯ <code>null</code> æˆ– <code>undefined</code> çš„å€¼ã€‚</li><li><code>sequential</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ <code>async</code>ï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†ç­‰å¾…å½“å‰é’©å­è§£å†³åå†è¿è¡Œã€‚</li><li><code>parallel</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ <code>async</code>ï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†å¹¶è¡Œè¿è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…å½“å‰é’©å­ã€‚</li></ul><h3 id="é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡"><span>é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡</span></a></h3><p>é™¤äº†å‡½æ•°ä¹‹å¤–ï¼Œé’©å­ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®é™…çš„é’©å­å‡½æ•°ï¼ˆæˆ– <code>banner/footer/intro/outro</code> çš„å€¼ï¼‰å¿…é¡»æŒ‡å®šä¸º <code>handler</code>ã€‚è¿™å…è®¸ä½ æä¾›æ›´å¤šçš„å¯é€‰å±æ€§ï¼Œä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼š</p><ul><li>order: &quot;pre&quot; | &quot;post&quot; | null</li></ul><p>å¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™å¯ä»¥å…ˆè¿è¡Œæ­¤æ’ä»¶ï¼ˆ<code>&quot;pre&quot;</code>ï¼‰ï¼Œæœ€åè¿è¡Œæ­¤æ’ä»¶ï¼ˆ<code>&quot;post&quot;</code>ï¼‰ï¼Œæˆ–åœ¨ç”¨æˆ·æŒ‡å®šçš„ä½ç½®è¿è¡Œï¼ˆæ²¡æœ‰å€¼æˆ– <code>null</code>ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">resolveFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;resolve-first&#39;</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token literal-property property">resolveId</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token string">&#39;pre&#39;</span><span class="token punctuation">,</span></span>
<span class="line">			<span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">				<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ„å»ºé’©å­æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#æ„å»ºé’©å­æ‰§è¡Œé¡ºåº"><span>æ„å»ºé’©å­æ‰§è¡Œé¡ºåº</span></a></h3><p><img src="`+e+`" alt="image-20230919180002325"></p><ol><li>é€šè¿‡ <code>options</code> é’©å­è¯»å–é…ç½®ï¼Œå¹¶è¿›è¡Œé…ç½®çš„è½¬æ¢ï¼Œå¾—åˆ°å¤„ç†åçš„é…ç½®å¯¹è±¡</li><li>è°ƒç”¨ <code>buildStart</code> é’©å­ï¼Œè€ƒè™‘äº†æ‰€æœ‰ <code>options</code>é’©å­é…ç½®çš„è½¬æ¢ï¼ŒåŒ…å«æœªè®¾ç½®é€‰é¡¹çš„æ­£ç¡®é»˜è®¤å€¼ï¼Œæ­£å¼å¼€å§‹æ„å»ºæµç¨‹</li><li>è°ƒç”¨ <code>resolveId</code> é’©å­è§£ææ¨¡å—æ–‡ä»¶è·¯å¾„ã€‚rollupä¸­æ¨¡å—æ–‡ä»¶çš„idå°±æ˜¯æ–‡ä»¶åœ°å€ï¼Œæ‰€ä»¥ï¼Œç±»ä¼¼resolveIdè¿™ç§å°±æ˜¯è§£ææ–‡ä»¶åœ°å€çš„æ„æ€ã€‚ä»<code>inputOption</code>çš„<code>input</code>é…ç½®æŒ‡å®šçš„å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œæ¯å½“åŒ¹é…åˆ°å¼•å…¥å¤–éƒ¨æ¨¡å—çš„è¯­å¥(å¦‚ï¼š<code>import moudleA from &#39;./moduleA&#39;</code>)ä¾¿ä¾æ¬¡æ‰§è¡Œæ³¨å†Œæ’ä»¶ä¸­çš„æ¯ä¸€ä¸ª <code>resolveId</code> é’©å­ï¼Œç›´åˆ°æŸä¸€ä¸ªæ’ä»¶ä¸­çš„ <code>resolveId</code> æ‰§è¡Œå®Œåè¿”å›é <code>null</code> æˆ–é <code>undefined</code> çš„å€¼ï¼Œå°†åœæ­¢æ‰§è¡Œåç»­æ’ä»¶çš„ <code>resolveId</code> é€»è¾‘å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªé’©å­</li><li>è°ƒç”¨<code>load</code>é’©å­åŠ è½½æ¨¡å—å†…å®¹ï¼Œ<code>resolveId</code>ä¸­çš„è·¯å¾„ä¸€èˆ¬ä¸ºç›¸å¯¹è·¯å¾„ï¼Œloadä¸­çš„è·¯å¾„ä¸ºå¤„ç†ä¹‹åçš„ç»å¯¹è·¯å¾„</li><li>æ¥ç€åˆ¤æ–­å½“å‰è§£æçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ‰§è¡Œæ‰€æœ‰çš„ <code>transform</code> é’©å­æ¥å¯¹æ¨¡å—å†…å®¹è¿›è¡Œè¿›è¡Œè‡ªå®šä¹‰çš„è½¬æ¢ï¼›è‹¥å­˜åœ¨åˆ™åˆ¤æ–­<code>shouldTransformCachedModule</code>å±æ€§ï¼Œtrueåˆ™æ‰§è¡Œæ‰€æœ‰çš„ <code>transform</code> é’©å­ï¼Œfalseåˆ™è¿›å…¥<code>moduleParsed</code>é’©å­é€»è¾‘</li><li>æ‹¿åˆ°æœ€åçš„æ¨¡å—å†…å®¹ï¼Œè¿›è¡Œ <code>AST</code> åˆ†æï¼Œè°ƒç”¨ <code>moduleParsed</code> é’©å­ã€‚å¦‚æœå†…éƒ¨æ²¡æœ‰<code>imports</code>å†…å®¹ï¼Œè¿›å…¥<code>buildEnd</code>ç¯èŠ‚ã€‚å¦‚æœè¿˜æœ‰<code>imports</code>å†…å®¹åˆ™ç»§ç»­ï¼Œå¦‚æœæ˜¯æ™®é€šçš„ <code>import</code>ï¼Œåˆ™æ‰§è¡Œ<code>resolveId</code> é’©å­ï¼Œç»§ç»­å›åˆ°<strong>æ­¥éª¤3-è°ƒç”¨resolveId</strong>ï¼›å¦‚æœæ˜¯åŠ¨æ€ <code>import</code>ï¼Œåˆ™æ‰§è¡Œ<code>resolveDynamicImport</code> é’©å­è§£æè·¯å¾„ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œåˆ™å›åˆ°<strong>æ­¥éª¤4-load</strong>åŠ è½½æ¨¡å—ï¼Œå¦åˆ™å›åˆ°æ­¥éª¤3é€šè¿‡ <code>resolveId</code> è§£æè·¯å¾„</li><li>ç›´åˆ°æ‰€æœ‰çš„ <code>import</code> éƒ½è§£æå®Œæ¯•ï¼Œ<code>Rollup</code> æ‰§è¡Œ<code>buildEnd</code>é’©å­ï¼ŒBuildé˜¶æ®µç»“æŸ</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// rollup-plugin-example.js</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;my-example&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">options</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ‰ -- options:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">buildStart</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;âœ¨ -- buildStart:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">resolveId</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span>importer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸš€ -- resolveId(source):&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸš€ -- resolveId(importer):&quot;</span><span class="token punctuation">,</span> importer<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">load</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸŒˆ ~ id:&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸŒŸ -- transform&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---&quot;</span><span class="token punctuation">,</span>code<span class="token punctuation">)</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">moduleParsed</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;â­ï¸ -- moduleParsed:&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">buildEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ˜ -- buildEnd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹"><span>è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> virtualModuleId <span class="token operator">=</span> <span class="token string">&#39;virtual-module&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// rollupçº¦å®šæ’ä»¶ä½¿ç”¨â€œè™šæ‹Ÿæ¨¡å—â€ï¼Œä½¿ç”¨\\0å‰ç¼€æ¨¡å— IDã€‚è¿™å¯ä»¥é˜²æ­¢å…¶ä»–æ’ä»¶å°è¯•å¤„ç†å®ƒã€‚</span></span>
<span class="line"><span class="token keyword">const</span> resolvedVirtualModuleId <span class="token operator">=</span> <span class="token string">&#39;\\0&#39;</span> <span class="token operator">+</span> virtualModuleId<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">virtualModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;virtual-module&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token function">resolveId</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">===</span> <span class="token string">&#39;virtual-module&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">        <span class="token keyword">return</span> resolvedVirtualModuleId<span class="token punctuation">;</span> <span class="token comment">// å‘Šè¯‰Rollupï¼Œè¿™ä¸ªIDæ˜¯å¤–éƒ¨æ¨¡å—ï¼Œä¸è¦åœ¨æ­¤å¤„æŸ¥æ‰¾å®ƒ</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">load</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸŒˆ - id:&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> resolvedVirtualModuleId<span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">        <span class="token comment">// return &#39;export default &quot;This is virtual!&quot;&#39;; // å‘Šè¯‰Rollupï¼Œå¦‚ä½•åŠ è½½æ­¤æ¨¡å—</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&#39;export default function fib(n) { return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2); }&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç•Œé¢è°ƒç”¨</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> fib <span class="token keyword">from</span> <span class="token string">&quot;virtual-module&quot;</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fib</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jsonæ’ä»¶ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#jsonæ’ä»¶ç¤ºä¾‹"><span>JSONæ’ä»¶ç¤ºä¾‹</span></a></h4><p>rollupé»˜è®¤æ˜¯ä¸èƒ½ç›´æ¥è¯»å–jsonæ–‡ä»¶çš„å†…å®¹çš„ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶å¤„ç†ä¸€ä¸‹ï¼Œä¸è¿‡å†™è¿™ä¸ªæ’ä»¶ä¹‹å‰ï¼Œæœ‰ä¸€äº›å°çŸ¥è¯†ç‚¹éœ€è¦è¡¥å……ä¸€ä¸‹</p><p><a href="https://github.com/rollup/plugins/tree/master/packages/pluginutils" target="_blank" rel="noopener noreferrer">@rollup/pluginutils</a> rollupå®˜æ–¹æä¾›çš„å·¥å…·æ’ä»¶,é‡Œé¢æœ‰ä¸€äº›åˆ¶ä½œæ’ä»¶å¸¸ç”¨çš„æ–¹æ³•</p><p><strong>å®‰è£…</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">pnpm add @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>commonjs @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>node<span class="token operator">-</span>resolve @rollup<span class="token operator">/</span>pluginutils <span class="token operator">-</span><span class="token constant">D</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a href="https://cn.rollupjs.org/plugin-development/#plugin-context" target="_blank" rel="noopener noreferrer">æ’ä»¶ä¸Šä¸‹æ–‡</a></p><p>è¿™ä¸ªå…¶å®ä¹Ÿæ˜¯æ’ä»¶ä¸­å¾ˆå¸¸ç”¨çš„ä¸€äº›apiï¼Œå¯ä»¥é€šè¿‡ <code>this</code> ä»å¤§å¤šæ•°<a href="https://cn.rollupjs.org/plugin-development/#build-hooks" target="_blank" rel="noopener noreferrer">é’©å­</a>ä¸­è®¿é—®ä¸€äº›å®ç”¨å‡½æ•°å’Œä¿¡æ¯ä½</p><p><strong>rollup-plugin-json</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter<span class="token punctuation">,</span>dataToEsm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@rollup/pluginutils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myJson</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// createFilter è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªidè·¯å¾„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</span></span>
<span class="line">  <span class="token comment">// è¿™ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦è¦å¤„ç†è¿™ä¸ªidè·¯å¾„</span></span>
<span class="line">  <span class="token comment">// rollup æ¨èæ¯ä¸€ä¸ª transform ç±»å‹çš„æ’ä»¶éƒ½éœ€è¦æä¾› include å’Œ exclude é€‰é¡¹ï¼Œç”Ÿæˆè¿‡æ»¤è§„åˆ™</span></span>
<span class="line">  <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>include<span class="token punctuation">,</span> options<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;rollup-plugin-json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&#39;.json&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// dataToEsm å°†æ•°æ®è½¬æ¢æˆesmæ¨¡å—</span></span>
<span class="line">            <span class="token comment">// å…¶å®å°±æ˜¯ export default &quot;xxx&quot;</span></span>
<span class="line">            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token function">dataToEsm</span><span class="token punctuation">(</span>parse<span class="token punctuation">)</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">mappings</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">          <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">&#39;Could not parse JSON file&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token literal-property property">cause</span><span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç•Œé¢è°ƒç”¨</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> pkg <span class="token keyword">from</span> <span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">&quot;../test.json&quot;</span><span class="token punctuation">;</span> <span class="token comment">// é”™è¯¯jsonæ ¼å¼æ¼”ç¤º</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ’ä»¶ä¸Šä¸‹æ–‡" tabindex="-1"><a class="header-anchor" href="#æ’ä»¶ä¸Šä¸‹æ–‡"><span><a href="https://cn.rollupjs.org/plugin-development/#plugin-context" target="_blank" rel="noopener noreferrer">æ’ä»¶ä¸Šä¸‹æ–‡</a></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@rollup/pluginutils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">customPlugin</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>include<span class="token punctuation">,</span> options<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;custom-plugin&#39;</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> parsedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£æä»£ç ,è·å–AST</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>parsedCode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">const</span> fileName <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>emitFile<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">fileName</span><span class="token operator">:</span> fileName <span class="token operator">+</span> <span class="token string">&#39;.txt&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          source<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å›¾ç‰‡è¯»å–" tabindex="-1"><a class="header-anchor" href="#å›¾ç‰‡è¯»å–"><span>å›¾ç‰‡è¯»å–</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter<span class="token punctuation">,</span>dataToEsm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@rollup/pluginutils&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> extname<span class="token punctuation">,</span>resolve<span class="token punctuation">,</span>basename<span class="token punctuation">,</span>relative<span class="token punctuation">,</span>normalize<span class="token punctuation">,</span>sep <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> svgToMiniDataURI <span class="token keyword">from</span> <span class="token string">&quot;mini-svg-data-uri&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> defaults <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> mimeTypes <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;.png&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.jpg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.jpeg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.gif&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/gif&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.svg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/svg+xml&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.ico&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/x-icon&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.webp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/webp&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;.avif&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/avif&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getDataUri</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> format<span class="token punctuation">,</span> isSvg<span class="token punctuation">,</span> mime<span class="token punctuation">,</span> source <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">  isSvg <span class="token operator">?</span> <span class="token function">svgToMiniDataURI</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">data:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>mime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>format<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">ensureDirExists</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dirPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> </span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">    <span class="token comment">// æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»ºæ–‡ä»¶å¤¹</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myImage</span><span class="token punctuation">(</span><span class="token parameter">opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">  <span class="token keyword">const</span> options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> defaults<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>include<span class="token punctuation">,</span> options<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;my-image&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// è·å–åç¼€</span></span>
<span class="line">      <span class="token keyword">const</span> ext <span class="token operator">=</span> <span class="token function">extname</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>mimeTypes<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// è·å–å›¾ç‰‡çš„mimeç±»å‹</span></span>
<span class="line">      <span class="token keyword">const</span> mime <span class="token operator">=</span> mimeTypes<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// åˆ¤æ–­æ˜¯å¦svg</span></span>
<span class="line">      <span class="token keyword">const</span> isSvg <span class="token operator">=</span> mime <span class="token operator">===</span> mimeTypes<span class="token punctuation">[</span><span class="token string">&quot;.svg&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// å›¾ç‰‡formatæ ¼å¼</span></span>
<span class="line">      <span class="token keyword">const</span> format <span class="token operator">=</span> isSvg <span class="token operator">?</span> <span class="token string">&quot;utf-8&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;base64&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// ç›®æ ‡è·¯å¾„</span></span>
<span class="line">      <span class="token keyword">const</span> assetsPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---&quot;</span><span class="token punctuation">,</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---&quot;</span><span class="token punctuation">,</span>options<span class="token punctuation">.</span>target<span class="token punctuation">)</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---&quot;</span><span class="token punctuation">,</span> assetsPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">//è·å–æ–‡ä»¶å</span></span>
<span class="line">      <span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// æœ€ç»ˆæ–‡ä»¶è·¯å¾„</span></span>
<span class="line">      <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>assetsPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;===&quot;</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">let</span> relativePath <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">relative</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      relativePath <span class="token operator">=</span> relativePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// å¦‚æœå›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œå°±åº”è¯¥ç›´æ¥æ‹·è´æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶è·¯å¾„</span></span>
<span class="line">        <span class="token comment">// è¯»å–å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸è®¾ç½®çš„å¤§å°è¿›è¡Œæ¯”è¾ƒ</span></span>
<span class="line">        <span class="token keyword">const</span> stat <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> options<span class="token punctuation">.</span>fileSize<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// æ–‡ä»¶çš„æ‹·è´ï¼Œä»¥åŠå¯¹è±¡çš„è¿”å›</span></span>
<span class="line">          <span class="token comment">// æ–‡ä»¶æ‹·è´ï¼Œæ— éå°±æ˜¯æ–‡ä»¶æºè·¯å¾„ï¼Œç›®æ ‡è·¯å¾„</span></span>
<span class="line">          <span class="token comment">//copyFile æ‹·è´æ–‡ä»¶åœ°å€çš„æ–‡ä»¶å¤¹å¿…é¡»å­˜åœ¨</span></span>
<span class="line">          <span class="token comment">// å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºæ–‡ä»¶å¤¹</span></span>
<span class="line">          <span class="token keyword">const</span> dirExists <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ensureDirExists</span><span class="token punctuation">(</span>assetsPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          dirExists <span class="token operator">&amp;&amp;</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token function">dataToEsm</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//è¿”å›æ‹·è´ä¹‹åå¤„ç†çš„è·¯å¾„</span></span>
<span class="line">            <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">mappings</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// å¦åˆ™è½¬æ¢ä¸ºbase64æ ¼å¼</span></span>
<span class="line">          <span class="token comment">// è¯»å–æ–‡ä»¶</span></span>
<span class="line">          <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token function">dataToEsm</span><span class="token punctuation">(</span><span class="token function">getDataUri</span><span class="token punctuation">(</span><span class="token punctuation">{</span> format<span class="token punctuation">,</span> isSvg<span class="token punctuation">,</span> mime<span class="token punctuation">,</span> source <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">mappings</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">        <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">&quot;å›¾ç‰‡è½¬æ¢å¤±è´¥:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token literal-property property">cause</span><span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº"><span>è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº</span></a></h3><p><img src="`+o+`" alt="image-20230920110457237"></p><ol><li>æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ <code>outputOptions</code> é’©å­å‡½æ•°ï¼Œå¯¹ <code>output</code> é…ç½®è¿›è¡Œè½¬æ¢</li><li>æ‰§è¡Œ <code>renderStart</code>ï¼Œè¯¥é’©å­è¯»å–æ‰€æœ‰outputOptionsé’©å­çš„è½¬æ¢ä¹‹åçš„è¾“å‡ºé€‰é¡¹</li><li>æ‰«æ <code>åŠ¨æ€import</code> è¯­å¥æ‰§è¡Œ <code>renderDynamicImport</code> é’©å­ï¼Œè®©å¼€å‘è€…èƒ½è‡ªå®šä¹‰<code>åŠ¨æ€import</code>çš„å†…å®¹ä¸è¡Œä¸º</li><li>å¹¶å‘æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ <code>bannerã€footerã€introã€outro</code> é’©å­ï¼Œè¿™å››ä¸ªé’©å­åŠŸèƒ½ç®€å•ï¼Œå°±æ˜¯å¾€æ‰“åŒ…äº§ç‰©çš„å›ºå®šä½ç½®(æ¯”å¦‚å¤´éƒ¨å’Œå°¾éƒ¨)æ’å…¥ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·ã€ä½œè€…ã€å†…å®¹ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰</li><li>æ˜¯å¦å­˜åœ¨ <code>import.meta</code> è¯­å¥ï¼Œæ²¡æœ‰å°±ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™ï¼šå¯¹äº<code>import.meta.url</code>è°ƒç”¨ <code>resolveFileUrl</code> æ¥è‡ªå®šä¹‰ url è§£æé€»è¾‘ã€‚å¯¹äº<code>import.meta</code>è°ƒç”¨ <code>resolveImportMeta</code> æ¥è¿›è¡Œè‡ªå®šä¹‰å…ƒä¿¡æ¯è§£æ</li><li>ç”Ÿæˆchunkè°ƒç”¨<code>renderChunk</code>é’©å­ï¼Œä¾¿äºåœ¨è¯¥é’©å­ä¸­è¿›è¡Œè‡ªå®šä¹‰æ“ä½œã€‚å¦‚æœç”Ÿæˆçš„chunkæ–‡ä»¶æœ‰hashå€¼ï¼Œæ‰§è¡Œ <code>augmentChunkHash</code> é’©å­ï¼Œæ¥å†³å®šæ˜¯å¦æ›´æ”¹ <code>chunk</code> çš„å“ˆå¸Œå€¼ã€‚</li><li>è°ƒç”¨ <code>generateBundle</code> é’©å­ï¼Œè¿™ä¸ªé’©å­çš„å…¥å‚é‡Œé¢ä¼šåŒ…å«æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>chunk</code> (æ‰“åŒ…åçš„ä»£ç )ã€<code>asset</code>(æœ€ç»ˆçš„é™æ€èµ„æºæ–‡ä»¶)ã€‚åœ¨è¿™ä¸ªé’©å­ä¸­ä½ åšè‡ªå®šä¹‰è‡ªå·±çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šå¯ä»¥åœ¨è¿™é‡Œåˆ é™¤ä¸€äº› <code>chunk</code> æˆ–è€… <code>asset</code>ï¼Œæœ€ç»ˆè¢«åˆ é™¤çš„å†…å®¹å°†ä¸ä¼šä½œä¸ºäº§ç‰©è¾“å‡º</li><li>ä¸ŠèŠ‚è¯¾è®²è§£çš„javascript api---<code>rollup.rollup</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>bundle</code>å¯¹è±¡ï¼Œ<code>bundle</code>å¯¹è±¡çš„writeæ–¹æ³•ï¼Œä¼šè§¦å‘<code>writeBundle</code>é’©å­ï¼Œä¼ å…¥æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>chunk</code> å’Œ <code>asset</code>ï¼Œä¸<code>generateBundle</code>é’©å­éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯<code>writeBundle</code>é’©å­æ‰§è¡Œçš„æ—¶å€™ï¼Œäº§ç‰©å·²ç»è¾“å‡ºäº†ã€‚è€Œ <code>generateBundle</code> æ‰§è¡Œçš„æ—¶å€™äº§ç‰©è¿˜å¹¶æ²¡æœ‰è¾“å‡ºã€‚ç®€å•æ¥è¯´ï¼Œé¡ºåºæ˜¯ï¼š<code>generateBundle---&gt;è¾“å‡ºå¹¶ä¿å­˜äº§ç‰©åˆ°ç£ç›˜---&gt;writeBundle</code></li><li>å½“<code>bundle</code>çš„<code>close</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘<code>closeBundle</code>é’©å­ï¼Œè¿™ä¸ªoutputé˜¶æ®µç»“æŸ</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myExample2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;my-example2&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">outputOptions</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ‰ ~ options:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">renderStart</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;âœ¨ ~ renderStart:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">renderDynamicImport</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;âœ¨~ renderDynamicImport:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">banner</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ”¥ ~ banner(chunk):&quot;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> comment <span class="token operator">=</span> chunk<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;index&quot;</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/*</span>
<span class="line">* </span>
<span class="line">* ã€€ã€€â”â”“ã€€ã€€ã€€â”â”“+ +</span>
<span class="line">* ã€€â”â”›â”»â”â”â”â”›â”»â”“ + +</span>
<span class="line">* ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ ã€€</span>
<span class="line">* ã€€â”ƒã€€ã€€ã€€â”ã€€ã€€ã€€â”ƒ ++ + + +</span>
<span class="line">*  â–ˆâ–ˆâ–ˆâ–ˆâ”â–ˆâ–ˆâ–ˆâ–ˆ â”ƒ+</span>
<span class="line">* ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ +</span>
<span class="line">* ã€€â”ƒã€€ã€€ã€€â”»ã€€ã€€ã€€â”ƒ</span>
<span class="line">* ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ + +</span>
<span class="line">* ã€€â”—â”â”“ã€€ã€€ã€€â”â”â”›</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ + + + +</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ +  ç¥å…½ä¿ä½‘</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ    ä»£ç æ— bugã€€ã€€</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒã€€ã€€+ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</span>
<span class="line">* ã€€ã€€ã€€â”ƒã€€ ã€€ã€€â”—â”â”â”â”“ + +</span>
<span class="line">* ã€€ã€€ã€€â”ƒ ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”£â”“</span>
<span class="line">* ã€€ã€€ã€€â”ƒ ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”â”›</span>
<span class="line">* ã€€ã€€ã€€â”—â”“â”“â”â”â”³â”“â”â”› + + + +</span>
<span class="line">* ã€€ã€€ã€€ã€€â”ƒâ”«â”«ã€€â”ƒâ”«â”«</span>
<span class="line">* ã€€ã€€ã€€ã€€â”—â”»â”›ã€€â”—â”»â”›+ + + +</span>
<span class="line">* </span>
<span class="line">*/</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> comment<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">renderChunk</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸš€ ~ source:&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">augmentChunkHash</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ‰ ~ augmentChunkHash:&quot;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">generateBundle</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸŒˆ ~ options:&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸŒˆ ~ bundle:&quot;</span><span class="token punctuation">,</span> bundle<span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> </span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;sum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">          <span class="token comment">//åˆ é™¤å¯¹è±¡ä¸­çš„è¿™ä¸ªé”®å€¼å¯¹</span></span>
<span class="line">          <span class="token keyword">delete</span> bundle<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">closeBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ˜ ~ closeBundle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹"><span>æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">bundleStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> startTime<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;bundle-stats&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">generateBundle</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> fileSizes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>fileName<span class="token punctuation">,</span> output<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>output<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;chunk&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> content <span class="token operator">=</span> output<span class="token punctuation">.</span>code<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> size <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> sizeInKB <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          fileSizes<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>sizeInKB<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> KB</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Bundle Stats:&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;-------------&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;File Sizes:&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileSizes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;-------------&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">closeBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> totalTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Total Bundle Time: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>totalTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;-------------&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»£ç å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ä»£ç å‹ç¼©"><span>ä»£ç å‹ç¼©</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> minify <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;uglify-js&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">uglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;uglify&#39;</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">renderChunk</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">minify</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">minify error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>result<span class="token punctuation">.</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">code</span><span class="token operator">:</span> result<span class="token punctuation">.</span>code<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">mappings</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,53)]))}const r=s(l,[["render",c],["__file","plugin.html.vue"]]),k=JSON.parse('{"path":"/advanced/rollup/plugin.html","title":"æ’ä»¶æœºåˆ¶","lang":"zh-CN","frontmatter":{"sidebarDepth":2},"headers":[{"level":2,"title":"Rollupæ’ä»¶æ¦‚è¿°","slug":"rollupæ’ä»¶æ¦‚è¿°","link":"#rollupæ’ä»¶æ¦‚è¿°","children":[{"level":3,"title":"çº¦å®š","slug":"çº¦å®š","link":"#çº¦å®š","children":[]},{"level":3,"title":"å±æ€§","slug":"å±æ€§","link":"#å±æ€§","children":[]}]},{"level":2,"title":"é’©å­å‡½æ•°çš„ç‰¹ç‚¹","slug":"é’©å­å‡½æ•°çš„ç‰¹ç‚¹","link":"#é’©å­å‡½æ•°çš„ç‰¹ç‚¹","children":[{"level":3,"title":"é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº","slug":"é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº","link":"#é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº","children":[]},{"level":3,"title":"é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼","slug":"é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼","link":"#é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼","children":[]},{"level":3,"title":"é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡","slug":"é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡","link":"#é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡","children":[]},{"level":3,"title":"æ„å»ºé’©å­æ‰§è¡Œé¡ºåº","slug":"æ„å»ºé’©å­æ‰§è¡Œé¡ºåº","link":"#æ„å»ºé’©å­æ‰§è¡Œé¡ºåº","children":[]},{"level":3,"title":"è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº","slug":"è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº","link":"#è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº","children":[]}]}],"git":{"updatedTime":1733483676000,"contributors":[{"name":"gang.peng","username":"gang.peng","email":"gang.peng@szyh.com","commits":1,"url":"https://github.com/gang.peng"}]},"filePathRelative":"advanced/rollup/plugin.md"}');export{r as comp,k as data};
